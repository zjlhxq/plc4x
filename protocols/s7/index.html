
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia
 Rendered using Reflow Maven Skin (http://andriusvelykis.github.io/reflow-maven-skin)
-->
                <html  xml:lang="en" lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Apache PLC4X® (Incubating) - S7</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta http-equiv="content-language" content="en" />

    <link href="../../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="../../css/docs.css" rel="stylesheet" />
    <link href="../../css/reflow-skin.css" rel="stylesheet" />


    <link href="../../css/lightbox.css" rel="stylesheet" />

    <link href="../../css/site.css" rel="stylesheet" />
    <link href="../../css/print.css" rel="stylesheet" media="print" />

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script src="../../js/html5.js"></script>
        <![endif]-->


    
<link rel="stylesheet" href="../../css/font-awesome.min.css"/>
</head>

<body class="page-protocols-s7-index project-plc4x-parent" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
                    <a class="brand" href="../../">Apache PLC4X (Incubating)</a>
                    <div class="nav-collapse collapse" id="top-nav-collapse">
                <ul class="nav pull-right">
                                        <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Users <b class="caret"></b></a>
    <ul class="dropdown-menu">
                <li ><a href="../../users/gettingstarted.html" title="Getting Started"    >Getting Started</a></li>
                <li ><a href="../../users/industry40.html" title="Industry 4.0 with Apache"    >Industry 4.0 with Apache</a></li>
        </ul>
</li>
                            <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
    <ul class="dropdown-menu">
                <li ><a href="../../developers/issues.html" title="Bug & Issue Tracker"    >Bug & Issue Tracker</a></li>
                <li ><a href="../../developers/building.html" title="Building PLC4X"    >Building PLC4X</a></li>
                <li ><a href="../../developers/sonar.html" title="Code Analysis"    >Code Analysis</a></li>
                <li ><a href="../../developers/ci.html" title="Continuous Integration"    >Continuous Integration</a></li>
                <li ><a href="../../developers/contributing.html" title="Contributing"    >Contributing</a></li>
                <li ><a href="../../developers/website.html" title="Website"    >Website</a></li>
                <li ><a href="../../developers/wiki.html" title="Wiki"    >Wiki</a></li>
        </ul>
</li>
                <li class="dropdown active">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Protocols <b class="caret"></b></a>
    <ul class="dropdown-menu">
                <li ><a href="../features.html" title="Features"    >Features</a></li>
                <li ><a href="../modbus/index.html" title="Modbus"    >Modbus</a></li>
                <li ><a href="../opc-ua/index.html" title="OPC-UA"    >OPC-UA</a></li>
                <li class="active"><a href="" title="S7/Profinet"    >S7/Profinet</a></li>
        </ul>
</li>
                                                                                        <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reports <b class="caret"></b></a>
    <ul class="dropdown-menu">
                <li class="dropdown-submenu ">
            <a href="../../project-info.html" title="Project Information"    >Project Information</a>
            <ul class="dropdown-menu">
                                <li ><a href="../../dependency-convergence.html" title="Dependency Convergence"    >Dependency Convergence</a></li>
                                <li ><a href="../../dependency-info.html" title="Dependency Information"    >Dependency Information</a></li>
                                <li ><a href="../../dependency-management.html" title="Dependency Management"    >Dependency Management</a></li>
                                <li ><a href="../../distribution-management.html" title="Distribution Management"    >Distribution Management</a></li>
                                <li ><a href="../../index.html" title="About"    >About</a></li>
                                <li ><a href="../../issue-tracking.html" title="Issue Management"    >Issue Management</a></li>
                                <li ><a href="../../license.html" title="Licenses"    >Licenses</a></li>
                                <li ><a href="../../mail-lists.html" title="Mailing Lists"    >Mailing Lists</a></li>
                                <li ><a href="../../modules.html" title="Project Modules"    >Project Modules</a></li>
                                <li ><a href="../../plugin-management.html" title="Plugin Management"    >Plugin Management</a></li>
                                <li ><a href="../../plugins.html" title="Plugins"    >Plugins</a></li>
                                <li ><a href="../../source-repository.html" title="Source Code Management"    >Source Code Management</a></li>
                                <li ><a href="../../project-summary.html" title="Summary"    >Summary</a></li>
                        </ul>
        </li>
                <li class="dropdown-submenu ">
            <a href="../../project-reports.html" title="Project Reports"    >Project Reports</a>
            <ul class="dropdown-menu">
                                <li ><a href="../../surefire-report.html" title="Surefire Report"    >Surefire Report</a></li>
                                <li ><a href="../../jacoco-aggregate/index.html" title="JaCoCo Aggregate"    >JaCoCo Aggregate</a></li>
                                <li ><a href="../../xref/index.html" title="Source Xref"    >Source Xref</a></li>
                                <li ><a href="../../xref-test/index.html" title="Test Source Xref"    >Test Source Xref</a></li>
                                <li ><a href="../../changelog.html" title="Change Log"    >Change Log</a></li>
                                <li ><a href="../../file-activity.html" title="File Activity"    >File Activity</a></li>
                                <li ><a href="../../dev-activity.html" title="Developer Activity"    >Developer Activity</a></li>
                        </ul>
        </li>
        </ul>
</li>
                    <li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
    <ul class="dropdown-menu">
                <li ><a href="../../plc4c/index.html" title="PLC4C"    >PLC4C</a></li>
                <li ><a href="../../plc4j/index.html" title="PLC4J"    >PLC4J</a></li>
                <li ><a href="../../plc4s/index.html" title="PLC4S"    >PLC4S</a></li>
                <li ><a href="../../integrations/index.html" title="Integrations"    >Integrations</a></li>
                <li ><a href="../../examples/index.html" title="Examples"    >Examples</a></li>
        </ul>
</li>
                                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </div>
</div>

<div class="container">

    <!-- Masthead
    ================================================== -->

    <header>
            <div class="jumbotron subhead">
            <div class="row" id="banner">
                <div class="span12">
                    <div class="pull-left">
                            <a href="https://plc4x.apache.org/" id="bannerLeft">        <img src="https://plc4x.apache.org/img/apache_plc4x_logo.png" alt='"'Apache PLC4X (incubating)'"' /></a>
    <p class="lead">The industrial IoT adapter</p>
                    </div>
                    <div class="pull-right">
                            <a href="http://incubator.apache.org/" id="bannerRight">        <img src="https://incubator.apache.org/images/incubator_feather_egg_logo_sm.png" alt='"'Apache Incubator'"' /></a>
                    </div>
                </div>
            </div>
        </div>
            <div>
            <ul class="breadcrumb">
                            <li class="projectVersion version-date">Version: 0.0.1-SNAPSHOT</li>
                        </ul>
        </div>
            <hr class="toc-separator" />
            <div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="250">
            <div class="navbar-inner">
                <div id="toc-scroll-target" class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <div class="nav-collapse collapse" id="toc-nav-collapse">
                        <ul id="toc" class="nav">
                                            <li class="toplevel"><a href="#s7" title="S7">S7</a></li>
<li class="toplevel"><a href="#overview_of_the_protocols" title="Overview of the Protocols">Overview of the Protocols</a></li>
<li class="toplevel"><a href="#protocol_descriptions" title="Protocol Descriptions">Protocol Descriptions</a></li>
<li class="dropdown">
    <a href="#interaction_with_an_s7_plc" title="Interaction with an S7 PLC" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Interaction with an S7 PLC <b class="caret"></b></a>
    <ul class="dropdown-menu" role="menu">
        <!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
        <li><a href="#interaction_with_an_s7_plc" title="Interaction with an S7 PLC">Interaction with an S7 PLC</a></li>
        <li class="divider"></li>
    <li><a href="#structure_of_a_connection_request" title="Structure of a Connection Request">Structure of a Connection Request</a></li>
<li><a href="#structure_of_a_connection_response" title="Structure of a Connection Response">Structure of a Connection Response</a></li>
<li><a href="#structure_of_a_setup_communication_request" title="Structure of a Setup Communication Request">Structure of a Setup Communication Request</a></li>
<li><a href="#structure_of_a_setup_communication_response" title="Structure of a Setup Communication Response">Structure of a Setup Communication Response</a></li>

    </ul>
</li>
<li class="toplevel"><a href="#links" title="Links">Links</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        </header>

    <div class="main-body">
        <div class="row">
            <div class="span12">
                <div class="body-content">
        <div class="sect1"> 
 <div class="page-header">
  <h2 id="s7">S7</h2>
 </div> 
 <div class="sectionbody"> 
  <div class="sect2"> 
   <h3 id="overview_of_the_protocols">Overview of the Protocols</h3> 
   <div class="imageblock"> 
    <div class="content"> 
     <img src="../../img/protocols-s7-osi.png" alt="protocols s7 osi" width="1130" height="812" /> 
    </div> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="protocol_descriptions">Protocol Descriptions</h3> 
   <table class="tableblock frame-all grid-all spread"> 
    <colgroup> 
     <col style="width: 25%;" /> 
     <col style="width: 25%;" /> 
     <col style="width: 25%;" /> 
     <col style="width: 25%;" /> 
    </colgroup> 
    <tbody> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">ISO</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RFC</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">Link</p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">Transmission Control Protocol (TCP)</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RFC 793</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tools.ietf.org/html/rfc793" class="bare">https://tools.ietf.org/html/rfc793</a></p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">ISO Transport Protocol (Class 4)</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">ISO DP 8073</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RFC 905</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tools.ietf.org/html/rfc905" class="bare">https://tools.ietf.org/html/rfc905</a></p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">ISO on TCP</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-&nbsp;</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RFC 1006</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tools.ietf.org/html/rfc1006" class="bare">https://tools.ietf.org/html/rfc1006</a></p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">S7 Protocol</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-&nbsp;</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gmiru.com/article/s7comm/" class="bare">http://gmiru.com/article/s7comm/</a> <a href="http://gmiru.com/article/s7comm-part2/" class="bare">http://gmiru.com/article/s7comm-part2/</a></p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RPC</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">RFC 1057 &amp; RFC 5531</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tools.ietf.org/html/rfc1057" class="bare">https://tools.ietf.org/html/rfc1057</a> <a href="https://tools.ietf.org/html/rfc5531" class="bare">https://tools.ietf.org/html/rfc5531</a></p></td> 
     </tr> 
     <tr> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">DCOM</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td> 
      <td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://msdn.microsoft.com/library/cc201989.aspx" class="bare">https://msdn.microsoft.com/library/cc201989.aspx</a></p></td> 
     </tr> 
    </tbody> 
   </table> 
   <div class="paragraph"> 
    <p>While a lot of information was available on the general structure of S7 communication, only little information was available on the constant values this protocol uses. If information was available, this was mostly provided with a GPL license and therefore was disqualified for being used in this project. The information on the S7 constants in this project were therefore generated by a little tool that generates &quot;pcapng&quot; files <code>WireShark</code> can process. The tool then generated 256 versions of a given template with the only difference being the one byte having all possible values. Using the <code>tshark</code> commandline tool, the generated packets were decoded to an XML format. For each examined byte an XPath expression was created to detect valid values. As soon as a valid value was found the tool then output the detected constant value to the console.</p> 
   </div> 
   <div class="paragraph"> 
    <p>The tool for generating this is located in the <code>plc4j/protocols/s7-utils</code> project.</p> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="interaction_with_an_s7_plc">Interaction with an S7 PLC</h3> 
   <div class="imageblock"> 
    <div class="content"> 
     <img src="../../img/s7-interaction.png" alt="s7 interaction" width="640" height="1275" /> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="structure_of_a_connection_request">Structure of a Connection Request</h4> 
    <div class="imageblock"> 
     <div class="content"> 
      <img src="../../img/s7-connection-request.svg" alt="s7 connection request" width="896" height="360" /> 
     </div> 
    </div> 
    <div class="paragraph"> 
     <p>Legend:</p> 
    </div> 
    <div class="ulist"> 
     <ul> 
      <li> <p><span class="protocolIsoOnTcp">ISO on TCP Packet Header</span></p> </li> 
      <li> <p><span class="protocolIsoTP">ISO Transport Protocol Packet Header</span></p> </li> 
      <li> <p><span class="protocolId">Part of the packet that identifies the type of request</span></p> </li> 
      <li> <p><span class="protocolParameter">Variable Parts of the ISO Transport Protocol Packet Header</span></p> </li> 
     </ul> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="structure_of_a_connection_response">Structure of a Connection Response</h4> 
    <div class="paragraph"> 
     <p>The <code>Connection Response</code> is identical to the <code>Connection Request</code> with the only difference that the <code>TPDU-Code</code> has a code of <code>0xD0</code>.</p> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="structure_of_a_setup_communication_request">Structure of a Setup Communication Request</h4> 
    <div class="imageblock"> 
     <div class="content"> 
      <img src="../../img/s7-setup-communication-request.svg" alt="s7 setup communication request" width="896" height="440" /> 
     </div> 
    </div> 
    <div class="paragraph"> 
     <p>Legend:</p> 
    </div> 
    <div class="ulist"> 
     <ul> 
      <li> <p><span class="protocolIsoOnTcp">ISO on TCP Packet Header</span></p> </li> 
      <li> <p><span class="protocolIsoTP">ISO Transport Protocol Packet Header</span></p> </li> 
      <li> <p><span class="protocolS7">S7 Protocol</span></p> </li> 
      <li> <p><span class="protocolId">Part of the packet that identifies the type of request</span></p> </li> 
      <li> <p><span class="protocolParameter">Variable Parts of the ISO Transport Protocol Packet Header</span></p> </li> 
     </ul> 
    </div> 
   </div> 
   <div class="sect3"> 
    <h4 id="structure_of_a_setup_communication_response">Structure of a Setup Communication Response</h4> 
    <div class="paragraph"> 
     <p>The <code>Setup Communication Response</code> is identical to the <code>Setup Communication Request</code> with the only difference that the <code>Message Type</code> has an ACK_DATA code of <code>0x03</code>.</p> 
    </div> 
    <div class="paragraph"> 
     <p>Also does the response eventually provide different values for <code>Max AMQ Caller</code>, <code>Max AMQ Callee</code> and <code>PDU Size</code>.</p> 
    </div> 
    <div class="paragraph"> 
     <p>The values might be lower than in the request, but never higher.</p> 
    </div> 
    <div class="admonitionblock tip"> 
     <table> 
      <tbody> 
       <tr> 
        <td class="icon"> 
         <div class="title">
           Tip 
         </div> </td> 
        <td class="content"> One thing about <code>Setup Communication Responses</code> which is kind of strange, is that usually S7 response messages have additional <code>error class</code> and <code>error code</code> fields, which this type of response doesn’t seem to have. </td> 
       </tr> 
      </tbody> 
     </table> 
    </div> 
   </div> 
  </div> 
  <div class="sect2"> 
   <h3 id="links">Links</h3> 
   <div class="paragraph"> 
    <p>Providing some additional information without directly being used:</p> 
   </div> 
   <div class="ulist"> 
    <ul> 
     <li> <p>High Level description: <a href="http://snap7.sourceforge.net/siemens_comm.html" class="bare">http://snap7.sourceforge.net/siemens_comm.html</a></p> </li> 
     <li> <p><a href="https://support.industry.siemens.com/cs/document/26483647/welche-eigenschaften-vorteile-und-besonderheiten-bietet-das-s7-protokoll-?dti=0&amp;lc=de-WW" class="bare">https://support.industry.siemens.com/cs/document/26483647/welche-eigenschaften-vorteile-und-besonderheiten-bietet-das-s7-protokoll-?dti=0&amp;lc=de-WW</a></p> </li> 
     <li> <p>Interesting presentation mentioning a new protocol flavor 0x72 instead of the old 0x32: <a href="https://www.research.ibm.com/haifa/Workshops/security2014/present/Avishai_Wool_AccurateModelingoftheSiemensS7SCADAProtocol-v5.pdf" class="bare">https://www.research.ibm.com/haifa/Workshops/security2014/present/Avishai_Wool_AccurateModelingoftheSiemensS7SCADAProtocol-v5.pdf</a></p> </li> 
     <li> <p>Open Source SCADA System: <a href="https://www.eclipse.org/eclipsescada/" class="bare">https://www.eclipse.org/eclipsescada/</a></p> </li> 
    </ul> 
   </div> 
  </div> 
 </div> 
</div>
        </div>
    </div>
        </div>
        </div>

    </div><!-- /container -->

    <!-- Footer
    ================================================== -->
    <footer class="well">
        <div class="container">
            <div class="row">
                                        <div class="span2 bottom-nav">
<ul class="nav nav-list">
    <li class="nav-header">Reports</li>
                                                        <li >
    <a href="../../project-info.html" title="Project Information"    >Project Information <i class="icon-chevron-right"></i></a>
</li>
                                <li >
    <a href="../../project-reports.html" title="Project Reports"    >Project Reports <i class="icon-chevron-right"></i></a>
</li>
</ul>
</div>
<div class="span2 bottom-nav">
<ul class="nav nav-list">
</ul>
</div>
<div class="span2 bottom-nav">
<ul class="nav nav-list">
    <li class="nav-header">Protocols</li>
    <li >
    <a href="../features.html" title="Features"    >Features</a>
</li>
    <li >
    <a href="../modbus/index.html" title="Modbus"    >Modbus</a>
</li>
    <li >
    <a href="../opc-ua/index.html" title="OPC-UA"    >OPC-UA</a>
</li>
    <li class="active">
    <a href="#" title="S7/Profinet"    >S7/Profinet</a>
</li>
</ul>
</div>
<div class="span3 bottom-nav">
<ul class="nav nav-list">
    <li class="nav-header">Modules</li>
    <li >
    <a href="../../plc4c/index.html" title="PLC4C"    >PLC4C</a>
</li>
    <li >
    <a href="../../plc4j/index.html" title="PLC4J"    >PLC4J</a>
</li>
    <li >
    <a href="../../plc4s/index.html" title="PLC4S"    >PLC4S</a>
</li>
    <li >
    <a href="../../integrations/index.html" title="Integrations"    >Integrations</a>
</li>
    <li >
    <a href="../../examples/index.html" title="Examples"    >Examples</a>
</li>
</ul>
</div>
                <div class="span3 bottom-description">
                                    <blockquote><p id="bottomNote"></p></blockquote>
                                </div>
                        </div>
        </div>
    </footer>

    <div class="container subfooter">
        <div class="row">
            <div class="span12">
                <p class="pull-right"><a href="#">Back to top</a></p>
                <p class="copyright">Copyright &copy;2017-2018 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All Rights Reserved.</p>
                            <p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
                        </div>
        </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../js/jquery.min.js"></script>

    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/lightbox.min.js"></script>
    <script src="../../js/reflow-scroll.js"></script>

    <script src="../../js/reflow-skin.js"></script>

</body>
</html>